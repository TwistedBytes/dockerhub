- pipeline: "Dockerhub builds"
  on: "CLICK"
  refs:
  - "refs/heads/main"
  priority: "NORMAL"
  actions:
  - action: "Lint Dockerfile"
    type: "DOCKERFILE_LINTER"
    local_path: "${dockerdir}/Dockerfile"
    shell_type: "sh"
  - action: "Build Docker image"
    type: "DOCKERFILE"
    docker_image_tag: "latest"
    dockerfile_path: "${dockerdir}/Dockerfile"
    context_path: "${dockerdir}"
    repository: "twistedbytes/${dockerdir}"
    trigger_conditions:
    - trigger_condition: "ON_CHANGE_AT_PATH"
      trigger_condition_paths:
      - "${dockerdir}/"
    target_platform: "linux/amd64"
    integration_hash: "9JOyLkQWjneg8XjlawZ1p0GDXN"
  - action: "Clear cache"
    type: "CLEAR_CACHE"
    cache_types:
    - "DOCKER"
    - "FILE_SYSTEM"
    - "SERVICES"
    - "ADDITIONAL"
    - "DOCKER_CLI"
  variables:
  - key: "dockerdir"
    value: "centos8-php81"
    type: "VAR"
    settable: true
- pipeline: "run all dirs"
  on: "EVENT"
  events:
  - type: "PUSH"
    refs:
    - "refs/heads/main"
  priority: "NORMAL"
  actions:
  - action: "Run dockerhub/Dockerhub builds"
    type: "RUN_NEXT_PIPELINE"
    comment: "Build ${dockerdir}: Triggered by $BUDDY_PIPELINE_NAME execution #$BUDDY_EXECUTION_ID"
    revision: "INHERIT"
    variables:
    - key: "dockerdir"
      value: "centos8-php81"
      type: "VAR"
    next_project_name: "dockerhub"
    next_pipeline_name: "Dockerhub builds"
  - action: "Run dockerhub/Dockerhub builds"
    type: "RUN_NEXT_PIPELINE"
    comment: "Build ${dockerdir}: Triggered by $BUDDY_PIPELINE_NAME execution #$BUDDY_EXECUTION_ID"
    revision: "INHERIT"
    variables:
      - key: "dockerdir"
        value: "centos8-php80"
        type: "VAR"
    next_project_name: "dockerhub"
    next_pipeline_name: "Dockerhub builds"
